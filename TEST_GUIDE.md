# 五险一金计算器测试指南

## 准备工作

1. **确保项目正在运行**
   ```bash
   cd shebao-app
   npm run dev
   ```
   - 访问 http://localhost:3000

2. **打开浏览器开发者工具**
   - 按 F12 或右键 -> 检查
   - 切换到 Console 标签查看错误日志

## 测试步骤

### 1. 主页测试 (/)
- [ ] 页面正常加载
- [ ] 显示"五险一金计算器"标题
- [ ] 显示两个功能卡片："数据上传"和"结果查询"
- [ ] 点击"数据上传"卡片能跳转到 /upload
- [ ] 点击"结果查询"卡片能跳转到 /results

### 2. 城市选择功能测试
- [ ] 进入 /upload 页面
- [ ] 城市下拉框应显示加载中
- [ ] 成功加载后显示预设城市（北京、上海、广州等）
- [ ] 能够选择不同的城市
- [ ] 年份选择器显示 2024、2023、2022
- [ ] 选择不同年份能正常工作

### 3. Excel 文件上传测试

#### 准备测试文件
创建两个 Excel 文件：

**cities.xlsx 内容示例：**
| city_name | year | base_min | base_max | rate |
|-----------|------|----------|----------|------|
| 北京 | 2024 | 6326 | 33891 | 0.17 |
| 上海 | 2024 | 7310 | 36549 | 0.165 |

**salaries.xlsx 内容示例：**
| employee_id | employee_name | month | salary_amount |
|-------------|---------------|-------|---------------|
| E001 | 张三 | 202401 | 8500 |
| E001 | 张三 | 202402 | 8500 |
| E002 | 李四 | 202401 | 12000 |

#### 上传测试
- [ ] 选择 cities.xlsx 文件
- [ ] 拖拽或点击上传城市标准数据
- [ ] 显示上传成功消息
- [ ] 选择 salaries.xlsx 文件
- [ ] 上传员工工资数据
- [ ] 显示上传成功消息

### 4. 计算功能测试
- [ ] 确保已选择城市（如：佛山）
- [ ] 确保已选择年份（如：2024）
- [ ] 点击"执行计算并存储结果"按钮
- [ ] 显示计算成功消息
- [ ] 提示显示成功计算的数量

### 5. 结果展示测试
- [ ] 进入 /results 页面
- [ ] 显示计算结果表格
- [ ] 表头包含：员工ID、员工姓名、城市、年份、平均工资、缴费基数、公司应缴金额
- [ ] 数据显示正确
- [ ] 底部显示合计金额
- [ ] 点击"导出 Excel"按钮能下载文件

## 常见问题排查

### 1. 城市选择器显示"暂无城市数据"
- 检查 Supabase 连接配置
- 执行 `database/seed_cities.sql` 添加测试数据

### 2. 文件上传失败
- 检查浏览器控制台错误
- 确认文件格式为 .xlsx 或 .xls
- 检查文件大小（小于 10MB）

### 3. 计算失败
- 确保已上传城市标准数据
- 确保已上传员工工资数据
- 检查是否选择了正确的城市和年份

### 4. 无结果显示
- 确保已经执行过计算
- 检查 Supabase 数据库中的 results 表

## 测试命令

在浏览器控制台运行以下命令进行快速测试：

```javascript
// 测试 API 连接
fetch('/api/cities')
  .then(res => res.json())
  .then(data => console.log('Cities API:', data))

// 测试 Supabase 连接
fetch('/api/results')
  .then(res => res.json())
  .then(data => console.log('Results API:', data))
```

## 性能测试

- [ ] 上传包含 100 条数据的文件
- [ ] 上传包含 1000 条数据的文件
- [ ] 计算大量数据时的响应时间

## 安全测试

- [ ] 尝试上传非 Excel 文件（应被拒绝）
- [ ] 尝试上传恶意文件
- [ ] 检查 API 是否有适当验证

## 完成检查

所有测试通过后，确认：
- [ ] 所有功能正常工作
- [ ] 错误处理完善
- [ ] 用户体验良好
- [ ] 数据准确无误